"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Custom = exports.Dev = exports.YiffyAPI = exports.WikiPageHistory = exports.WikiPage = exports.User = exports.Takedown = exports.TagHistory = exports.Tag = exports.PostSet = exports.PostHistory = exports.PostApproval = exports.Post = exports.PostFlag = exports.PoolHistory = exports.Pool = exports.NoteHistory = exports.Note = exports.Blip = exports.ArtistHistory = exports.Artist = exports.AuthenticatedUser = exports.APIError = void 0;
const RequestHandler_1 = __importDefault(require("./util/RequestHandler"));
// Modules
const Artists_1 = __importDefault(require("./modules/Artists"));
const Blips_1 = __importDefault(require("./modules/Blips"));
const Notes_1 = __importDefault(require("./modules/Notes"));
const Pools_1 = __importDefault(require("./modules/Pools"));
const Posts_1 = __importDefault(require("./modules/Posts"));
const PostFlags_1 = __importDefault(require("./modules/PostFlags"));
const PostSets_1 = __importDefault(require("./modules/PostSets"));
const Tags_1 = __importDefault(require("./modules/Tags"));
const Takedowns_1 = __importDefault(require("./modules/Takedowns"));
const UserFeedback_1 = __importDefault(require("./modules/UserFeedback"));
const Users_1 = __importDefault(require("./modules/Users"));
const WikiPages_1 = __importDefault(require("./modules/WikiPages"));
// Structures
const Artist_1 = __importDefault(require("./structures/Artist"));
exports.Artist = Artist_1.default;
const ArtistHistory_1 = __importDefault(require("./structures/ArtistHistory"));
exports.ArtistHistory = ArtistHistory_1.default;
const Blip_1 = __importDefault(require("./structures/Blip"));
exports.Blip = Blip_1.default;
const Note_1 = __importDefault(require("./structures/Note"));
exports.Note = Note_1.default;
const NoteHistory_1 = __importDefault(require("./structures/NoteHistory"));
exports.NoteHistory = NoteHistory_1.default;
const AuthenticatedUser_1 = __importDefault(require("./structures/AuthenticatedUser"));
exports.AuthenticatedUser = AuthenticatedUser_1.default;
const Pool_1 = __importDefault(require("./structures/Pool"));
exports.Pool = Pool_1.default;
const PoolHistory_1 = __importDefault(require("./structures/PoolHistory"));
exports.PoolHistory = PoolHistory_1.default;
const PostFlag_1 = __importDefault(require("./structures/PostFlag"));
exports.PostFlag = PostFlag_1.default;
const Post_1 = __importDefault(require("./structures/Post"));
exports.Post = Post_1.default;
const PostApproval_1 = __importDefault(require("./structures/PostApproval"));
exports.PostApproval = PostApproval_1.default;
const PostHistory_1 = __importDefault(require("./structures/PostHistory"));
exports.PostHistory = PostHistory_1.default;
const PostSet_1 = __importDefault(require("./structures/PostSet"));
exports.PostSet = PostSet_1.default;
const Tag_1 = __importDefault(require("./structures/Tag"));
exports.Tag = Tag_1.default;
const Takedown_1 = __importDefault(require("./structures/Takedown"));
exports.Takedown = Takedown_1.default;
const TagHistory_1 = __importDefault(require("./structures/TagHistory"));
exports.TagHistory = TagHistory_1.default;
const User_1 = __importDefault(require("./structures/User"));
exports.User = User_1.default;
const WikiPage_1 = __importDefault(require("./structures/WikiPage"));
exports.WikiPage = WikiPage_1.default;
const WikiPageHistory_1 = __importDefault(require("./structures/WikiPageHistory"));
exports.WikiPageHistory = WikiPageHistory_1.default;
const package_json_1 = __importDefault(require("../package.json"));
// note for future reference (browser compatibility?)
// POST with "_method=*" can be used in place of PUT/PATCH/DELETE
class E621 {
    static YiffyAPI;
    static Dev;
    static Custom;
    POST_LIMIT_PER_REQUEST = 320;
    request = new RequestHandler_1.default(this);
    artists = new Artists_1.default(this);
    blips = new Blips_1.default(this);
    notes = new Notes_1.default(this);
    pools = new Pools_1.default(this);
    posts = new Posts_1.default(this);
    postFlags = new PostFlags_1.default(this);
    postSets = new PostSets_1.default(this);
    tags = new Tags_1.default(this);
    takedowns = new Takedowns_1.default(this);
    userFeedback = new UserFeedback_1.default(this);
    users = new Users_1.default(this);
    wikiPages = new WikiPages_1.default(this);
    auth;
    options;
    constructor(options) {
        if (!options)
            options = {};
        Object.defineProperties(this, {
            auth: {
                get() {
                    return !this.options.authUser || !this.options.authKey ? null : `Basic ${Buffer.from(`${this.options.authUser}:${this.options.authKey}`).toString("base64")}`;
                },
                configurable: false,
                enumerable: false
            },
            options: {
                value: {
                    authUser: options.authUser ?? null,
                    authKey: options.authKey ?? null,
                    userAgent: options.userAgent ?? `E621/${package_json_1.default.version} (https://github.com/DonovanDMC/E621${!options.authUser ? "" : `; "${options.authUser}"`})`,
                    requestTimeout: options.requestTimeout ?? 30
                },
                configurable: false,
                enumerable: false,
                writable: false
            }
        });
        this.setInstance({});
    }
    setInstance(opt) {
        if (!opt.host)
            opt.host = "e621.net";
        opt.ssl = opt.ssl ?? ["e621.net", "yiff.rest"].includes(opt.host);
        if (!opt.port)
            opt.port = opt.ssl ? 443 : 80;
        if (!opt.imageReconstructionType) {
            switch (opt.host) {
                case "e621.net":
                    opt.imageReconstructionType = "e621";
                    break;
                case "yiff.rest":
                    opt.imageReconstructionType = "yiffy";
                    break;
                case "e621.local":
                case "e621ng.local":
                case "localhost":
                    opt.imageReconstructionType = "dev";
                    break;
                default: {
                    opt.imageReconstructionType = null;
                    if (!opt.reconstructStaticURL)
                        process.emitWarning("You specified a host that wasn't in our known list (e621.net, yiff.rest, e621.local) and didn't also specify imageReconstructionType or reconstructStaticURL. This WILL cause an error if we see any null file urls.");
                }
            }
        }
        Object.assign(this.options, {
            instanceHost: opt.host,
            instancePort: opt.port,
            instanceSSL: opt.ssl,
            reconstructStaticURL: opt.reconstructStaticURL || null,
            imageReconstructionType: opt.imageReconstructionType || "hierarchy"
        });
    }
}
exports.default = E621;
class YiffyAPI extends E621 {
    constructor(options) {
        super(options);
        this.setInstance({
            host: "yiff.rest",
            port: 443,
            ssl: true
        });
    }
}
exports.YiffyAPI = YiffyAPI;
class Dev extends E621 {
    constructor(options, ssl = false) {
        super(options);
        this.setInstance({
            host: "localhost",
            port: 3000,
            ssl
        });
    }
}
exports.Dev = Dev;
class Custom extends E621 {
    constructor(options, instanceOptions) {
        super(options);
        this.setInstance(instanceOptions);
    }
}
exports.Custom = Custom;
// due to extending the main class, neither of these (E621 class & sub-class) can happen "first", when both need to
E621.YiffyAPI = YiffyAPI;
E621.Dev = Dev;
E621.Custom = Custom;
module.exports = E621;
var RequestHandler_2 = require("./util/RequestHandler");
Object.defineProperty(exports, "APIError", { enumerable: true, get: function () { return RequestHandler_2.APIError; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSwyRUFBbUQ7QUFDbkQsVUFBVTtBQUNWLGdFQUF3QztBQUN4Qyw0REFBb0M7QUFDcEMsNERBQW9DO0FBQ3BDLDREQUFvQztBQUNwQyw0REFBb0M7QUFDcEMsb0VBQTRDO0FBQzVDLGtFQUEwQztBQUMxQywwREFBa0M7QUFDbEMsb0VBQTRDO0FBQzVDLDBFQUFrRDtBQUNsRCw0REFBb0M7QUFDcEMsb0VBQTRDO0FBQzVDLGFBQWE7QUFDYixpRUFBeUM7QUF1SXhDLGlCQXZJTSxnQkFBTSxDQXVJTjtBQXRJUCwrRUFBdUQ7QUF1SXRELHdCQXZJTSx1QkFBYSxDQXVJTjtBQXRJZCw2REFBcUM7QUF1SXBDLGVBdklNLGNBQUksQ0F1SU47QUF0SUwsNkRBQXFDO0FBdUlwQyxlQXZJTSxjQUFJLENBdUlOO0FBdElMLDJFQUFtRDtBQXVJbEQsc0JBdklNLHFCQUFXLENBdUlOO0FBdElaLHVGQUErRDtBQWlJOUQsNEJBaklNLDJCQUFpQixDQWlJTjtBQWhJbEIsNkRBQXFDO0FBc0lwQyxlQXRJTSxjQUFJLENBc0lOO0FBcklMLDJFQUFtRDtBQXNJbEQsc0JBdElNLHFCQUFXLENBc0lOO0FBcklaLHFFQUE2QztBQXNJNUMsbUJBdElNLGtCQUFRLENBc0lOO0FBcklULDZEQUFxQztBQXNJcEMsZUF0SU0sY0FBSSxDQXNJTjtBQXJJTCw2RUFBcUQ7QUFzSXBELHVCQXRJTSxzQkFBWSxDQXNJTjtBQXJJYiwyRUFBbUQ7QUFzSWxELHNCQXRJTSxxQkFBVyxDQXNJTjtBQXJJWixtRUFBMkM7QUFzSTFDLGtCQXRJTSxpQkFBTyxDQXNJTjtBQXJJUiwyREFBbUM7QUFzSWxDLGNBdElNLGFBQUcsQ0FzSU47QUFySUoscUVBQTZDO0FBdUk1QyxtQkF2SU0sa0JBQVEsQ0F1SU47QUF0SVQseUVBQWlE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